FROM quay.io/operator-framework/ansible-operator:v0.8.2

USER root

RUN echo "${USER_NAME}:x:${USER_UID}:0:${USER_NAME} user:${HOME}:/sbin/nologin" >> /etc/passwd

# Install latest of pip
RUN yum install -y git python3-pip python3-devel gcc
RUN pip3 install --upgrade pip

# Install latest of ansible
RUN pip3 install --upgrade \
    ansible \
    psutil \
    jmespath

RUN yum remove -y python3-devel gcc
RUN yum clean all

USER ${USER_UID}

RUN curl --silent \
    -o ${HOME}/agnosticv_cli \
    https://github.com/redhat-cop/agnosticv/releases/download/v0.1.0/agnosticv_linux_amd64
RUN chmod +x ${HOME}/agnosticv_cli
COPY ansible.cfg /etc/ansible/ansible.cfg
COPY watches.yaml ${HOME}/watches.yaml
COPY playbook.yaml ${HOME}/playbook.yaml
COPY roles/ ${HOME}/roles/
