---
apiVersion: template.openshift.io/v1
kind: templates
metadata:
  name: {{ account | replace('_', '-') }}.{{ catalog_item | lower | replace('_', '-') }}.{{ stage }}
  annotations:
    description: "{{ vars.merged_vars.agnosticv_meta.catalog_description | d(default_description) }}"
  openshift.io/provider-display-name: Red Hat, Inc.
  labels:
    samples.operator.openshift.io/managed: "true"
  tags: quickstart,babylon,{{ account | replace('_', '-') }},{{ vars.merged_vars.agnosticv_meta.catalog_tags | d('') }}
message: "{{ vars.merged_vars.agnosticv_meta.catalog_message | d(default_message) }}"
objects:
- apiVersion: gpte.redhat.com/v1
  kind: ResourceClaim
  metadata:
    generateName: anarchy-subject-
  spec:
    template:
      apiVersion: gpte.redhat.com/v1
      kind: AnarchySubject
      metadata:
        generateName: {{ account | replace('_', '-') }}.{{ catalog_item | lower | replace('_', '-') }}.{{ stage }}-
        labels:
          governor: {{ account | replace('_', '-') }}.{{ catalog_item | lower | replace('_', '-') }}.{{ stage }}
      spec:
        governor: {{ account | replace('_', '-') }}.{{ catalog_item | lower | replace('_', '-') }}.{{ stage }}
        parameters:
{% for key in vars.merged_vars if
  key in vars.merged_vars.agnosticv_meta.catalog_parameters | d([]) | json_query('[].name') %}
    {{ key }}: {{ vars.merged_vars[key] | to_json }}
{% endfor %}
{% for param in vars.merged_vars.agnosticv_meta.catalog_parameters | d([]) %}
          {{ param.name | lower }}: ${ {{ param.name }} }
{% endfor %}

parameters: {{ vars.merged_vars.agnosticv_meta.catalog_parameters | d([]) | to_json }}
labels: {{ default_labels | combine(vars.merged_vars.agnosticv_meta.catalog_labels | d({})) | to_json }}
